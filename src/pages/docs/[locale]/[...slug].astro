---
import { getEntry, getCollection } from 'astro:content';
import DocLayout from '@/layouts/DocLayout.astro';

const { locale, slug } = Astro.params ?? {};
if (!locale) {
  throw new Error(`Missing route parameters`);
}
const slugPath = Array.isArray(slug) ? slug.join('/') : (slug ?? '');
// If no slug was provided (index route), use 'index'
const entrySlug = slugPath === '' ? `${locale}/index` : `${locale}/${slugPath}`;
const { Content, data } = await (await getEntry('docs', entrySlug)).render();

export async function getStaticPaths() {
  const docs = await getCollection('docs');

  return docs.map((doc) => {
    const [locale, ...slugParts] = doc.slug.split('/');
    const slug = slugParts.length === 1 && slugParts[0] === 'index'
      ? undefined
      : slugParts.length <= 1
        ? slugParts[0]
        : slugParts;

    return {
      params: { locale, slug },
    };
  });
}

---

<DocLayout title={data.title}>
  <Content />
</DocLayout>
